<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Bank - PrepSharp Free</title>
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    <link rel="stylesheet" href="../../assets/css/dropdown-override.css">
    <link rel="stylesheet" href="../../assets/css/dark-mode.css">
    <link rel="stylesheet" href="../../assets/css/font-size.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../assets/css/mobile.css">
    <link rel="stylesheet" href="../../assets/css/mobile-dashboard.css">
    <link rel="stylesheet" href="../../assets/css/mobile-fix.css">
    <style>
        :root {
            --primary-color-transparent: rgba(79, 70, 229, 0.1);
        }
        
        .dark-mode {
            --primary-color-transparent: rgba(79, 70, 229, 0.2);
        }
        
        .panels-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .exam-panel {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            color: var(--text-color);
        }
        
        .exam-panel:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-color: #4f46e5;
        }
        
        .exam-title {
            font-size: 24px;
            font-weight: 600;
            margin: 15px 0;
        }
        
        .exam-description {
            color: var(--text-light);
            margin-bottom: 20px;
        }
        
        .exam-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .exam-btn:hover {
            background: linear-gradient(135deg, #3730a3, #6b21a8);
            transform: translateY(-2px);
        }
        
        .subject-selection, .chapter-selection, .questions-section {
            display: none;
        }
        
        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .subject-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            border: 2px solid transparent;
            height: 180px;
        }
        
        .subject-card:nth-child(1) {
            border-color: #FFA500; /* Orange for Physics */
        }
        
        .subject-card:nth-child(2) {
            border-color: #28A745; /* Green for Chemistry */
        }
        
        .subject-card:nth-child(3) {
            border-color: #007BFF; /* Blue for Mathematics */
        }
        
        .subject-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            opacity: 0.1;
            z-index: 1;
        }
        
        .subject-card:nth-child(1)::after {
            background-color: #FFA500;
        }
        
        .subject-card:nth-child(2)::after {
            background-color: #28A745;
        }
        
        .subject-card:nth-child(3)::after {
            background-color: #007BFF;
        }
        
        .subject-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--primary-color-transparent), transparent);
            transform: translate(-50%, -50%);
            transition: all 0.4s ease;
            border-radius: 50%;
        }
        
        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        
        .subject-card h3 {
            margin: 0 0 15px 0;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .subject-card h3 .arrow {
            font-size: 1rem;
            color: #333;
            transition: transform 0.3s ease;
        }
        
        .subject-card:hover h3 .arrow {
            transform: translateX(5px);
        }
        
        .subject-total {
            font-size: 0.95rem;
            color: var(--text-light);
            font-weight: 500;
            position: relative;
            z-index: 2;
            margin-bottom: 5px;
        }
        
        .subject-chapters {
            font-size: 0.95rem;
            color: var(--text-light);
            font-weight: 500;
            position: relative;
            z-index: 2;
            margin-bottom: 15px;
        }
        
        .subject-icon {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            z-index: 3;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .subject-card:nth-child(1) .subject-icon {
            background-color: #FFA500; /* Orange for Physics */
        }
        
        .subject-card:nth-child(2) .subject-icon {
            background-color: #28A745; /* Green for Chemistry */
        }
        
        .subject-card:nth-child(3) .subject-icon {
            background-color: #007BFF; /* Blue for Mathematics */
        }
        
        .chapter-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .chapter-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .chapter-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(180deg, #4f46e5, #7c3aed, #ec4899);
            border-radius: 16px 0 0 16px;
        }
        
        .chapter-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-color-transparent), transparent);
            transition: right 0.4s ease;
        }
        
        .chapter-card:hover {
            transform: translateX(12px) scale(1.02);
            box-shadow: 0 15px 35px rgba(79, 70, 229, 0.15);
            border-color: #4f46e5;
        }
        
        .chapter-card:hover::after {
            right: 100%;
        }
        
        .chapter-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chapter-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .chapter-details h4 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .chapter-subtitle {
            font-size: 0.85rem;
            color: var(--text-light);
            margin: 0;
        }
        

        
        .question-count {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
            position: relative;
            z-index: 2;
        }
        
        .question-item {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 0;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .question-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed, #ec4899, #f59e0b);
        }
        
        .question-item:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(79, 70, 229, 0.15);
            border-color: #4f46e5;
        }
        
        .question-header {
            padding: 20px 25px 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .question-number {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
        }
        
        .question-content {
            padding: 20px 25px;
        }
        
        .question-item img {
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            width: 100%;
            height: 50px;
            object-fit: contain;
            object-position: top;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
            background: var(--bg-light);
        }
        
        .question-item img:hover {
            transform: scale(1.02);
        }
        
        .question-meta {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-light);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-light);
        }
        
        .meta-icon {
            font-size: 16px;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .back-btn:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="../../logo for index (1).png" alt="PrepSharp Logo" class="logo">
                <h2>PrepSharp</h2>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="dashboard.html"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
                    <li><a href="practice-papers.html"><i class="fas fa-book"></i> <span>Practice Papers</span></a></li>
                    <li><a href="analytics.html"><i class="fas fa-chart-line"></i> <span>Analytics</span></a></li>
                    <li class="active"><a href="question-bank.html"><i class="fas fa-question-circle"></i> <span>Question Bank</span></a></li>
                    <li><a href="study-plan.html"><i class="fas fa-calendar-alt"></i> <span>Study Plan</span></a></li>
                    <li><a href="ai-coach.html"><i class="fas fa-robot"></i> <span>AI Coach</span></a></li>
                    <li><a href="peer-comparison.html"><i class="fas fa-users"></i> <span>Peer Comparison</span></a></li>
                    <li><a href="settings.html"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
                </ul>
            </nav>
        </aside>
        
        <main class="main-content">
            <div class="dashboard-content">
                <div class="welcome-section">
                    <h1>Question Bank</h1>
                    <p>Choose your exam type to practice questions</p>
                </div>
                
                <div class="panels-container" id="examPanels">
                    <div class="exam-panel" onclick="selectExam('advanced')">
                        <div class="exam-icon">
                            <img src="../../images/jee advanced.png" alt="JEE Advanced" style="width: 80px; height: 80px;">
                        </div>
                        <h2 class="exam-title">JEE Advanced</h2>
                        <p class="exam-description">Practice advanced level questions for JEE Advanced preparation</p>
                        <button class="exam-btn">Start Practice</button>
                    </div>
                    
                    <div class="exam-panel" onclick="window.location.href='jee-mains-subjects.html'">
                        <div class="exam-icon">
                            <img src="../../images/jee mains.png" alt="JEE Mains" style="width: 80px; height: 80px;">
                        </div>
                        <h2 class="exam-title">JEE Mains</h2>
                        <p class="exam-description">Practice fundamental questions for JEE Mains preparation</p>
                        <button class="exam-btn">Start Practice</button>
                    </div>
                </div>
                
                <div class="subject-selection" id="subjectSelection">
                    <button class="back-btn" onclick="showExamPanels()">← Back</button>
                    <h2>Choose Subject</h2>
                    <div class="subject-grid">
                        <div class="subject-card" onclick="selectSubject('physics')">
                            <h3>Physics <span class="arrow"><i class="fas fa-chevron-right"></i></span></h3>
                            <div class="subject-chapters" id="physics-chapters">42 Chapters</div>
                            <div class="subject-total" id="physics-total">Loading...</div>
                            <div class="subject-icon"><i class="fas fa-atom"></i></div>
                        </div>
                        <div class="subject-card" onclick="selectSubject('chemistry')">
                            <h3>Chemistry <span class="arrow"><i class="fas fa-chevron-right"></i></span></h3>
                            <div class="subject-chapters" id="chemistry-chapters">33 Chapters</div>
                            <div class="subject-total" id="chemistry-total">Loading...</div>
                            <div class="subject-icon"><i class="fas fa-flask"></i></div>
                        </div>
                        <div class="subject-card" onclick="selectSubject('mathematics')">
                            <h3>Mathematics <span class="arrow"><i class="fas fa-chevron-right"></i></span></h3>
                            <div class="subject-chapters" id="mathematics-chapters">36 Chapters</div>
                            <div class="subject-total" id="mathematics-total">Loading...</div>
                            <div class="subject-icon"><i class="fas fa-calculator"></i></div>
                        </div>
                    </div>
                </div>
                
                <div class="chapter-selection" id="chapterSelection">
                    <button class="back-btn" onclick="showSubjectSelection()">← Back</button>
                    <h2>Choose Chapter</h2>
                    <div class="chapter-grid" id="chapterGrid"></div>
                </div>
                
                <div class="questions-section" id="questionsSection">
                    <button class="back-btn" onclick="showChapterSelection()">← Back</button>
                    <h2>📚 Questions</h2>
                    <div id="questionsList"></div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="../../js/free-theme-manager.js"></script>
    <script src="../../js/mobile.js"></script>
    <script>
        let selectedExam = '';
        let selectedSubject = '';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCtkee-Lv8lEMestaSVJxx7yvKB-lBygPQ",
            authDomain: "prepsharp-c91fd.firebaseapp.com",
            projectId: "prepsharp-c91fd",
            storageBucket: "prepsharp-c91fd.firebasestorage.app",
            messagingSenderId: "688294848433",
            appId: "1:688294848433:web:dd93fc6d61d62392473f90"
        };
        
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }
        
        // Restore state on page load
        window.addEventListener('load', function() {
            // Load user preferences
            loadUserPreferences();
            
            const savedExam = localStorage.getItem('selectedExam');
            const savedSubject = localStorage.getItem('selectedSubject');
            const savedChapter = localStorage.getItem('selectedChapter');
            
            if (savedChapter && savedSubject && savedExam) {
                selectedExam = savedExam;
                selectedSubject = savedSubject;
                document.getElementById('examPanels').style.display = 'none';
                document.getElementById('subjectSelection').style.display = 'none';
                document.getElementById('chapterSelection').style.display = 'none';
                document.getElementById('questionsSection').style.display = 'block';
                loadQuestions(savedChapter);
            } else if (savedSubject && savedExam) {
                selectedExam = savedExam;
                selectedSubject = savedSubject;
                document.getElementById('examPanels').style.display = 'none';
                document.getElementById('subjectSelection').style.display = 'none';
                document.getElementById('chapterSelection').style.display = 'block';
                loadChapters(savedSubject);
            } else if (savedExam) {
                selectedExam = savedExam;
                document.getElementById('examPanels').style.display = 'none';
                document.getElementById('subjectSelection').style.display = 'block';
                loadSubjectTotals();
            }
        });
        
        // Load user preferences from Firebase
        async function loadUserPreferences() {
            try {
                const loggedInUser = localStorage.getItem('loggedInUser') || sessionStorage.getItem('loggedInUser');
                if (loggedInUser) {
                    const userData = JSON.parse(loggedInUser);
                    const userId = userData.email || 'default-user';
                    
                    const doc = await db.collection('users').doc(userId).get();
                    if (doc.exists && doc.data().preferences) {
                        const preferences = doc.data().preferences;
                        
                        // Apply dark mode if enabled
                        if (preferences.darkMode) {
                            document.body.classList.add('dark-mode');
                        }
                        
                        // Apply font size
                        if (preferences.fontSize) {
                            document.documentElement.setAttribute('data-font-size', preferences.fontSize);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading user preferences:', error);
            }
        }
        
        function selectExam(exam) {
            selectedExam = exam;
            localStorage.setItem('selectedExam', exam);
            document.getElementById('examPanels').style.display = 'none';
            document.getElementById('subjectSelection').style.display = 'block';
            loadSubjectTotals();
        }
        
        function selectSubject(subject) {
            selectedSubject = subject;
            localStorage.setItem('selectedSubject', subject);
            document.getElementById('subjectSelection').style.display = 'none';
            document.getElementById('chapterSelection').style.display = 'block';
            loadChapters(subject);
        }
        
        async function loadSubjectTotals() {
            const subjects = ['physics', 'chemistry', 'mathematics'];
            const chapters = {
                physics: ["Mathematics in Physics", "Units and Dimensions", "Motion In One Dimension", "Motion In Two Dimensions", "Laws of Motion", "Work Power Energy", 
                    "Center of Mass Momentum and Collision", "Rotational Motion", "Gravitation", "Mechanical Properties of Solids", "Mechanical Properties of Fluids", "Thermal Properties of Matter", 
                    "Thermodynamics", "Kinetic Theory of Gases", "Oscillations", "Waves and Sound", "Electrostatics", "Capacitance", "Current Electricity", 
                    "Magnetic Properties of Matter", "Magnetic Effects of Current", "Electromagnetic Induction", "Alternating Current", "Electromagnetic Waves", 
                    "Ray Optics", "Wave Optics", "Dual Nature of Matter", "Atomic Physics", "Nuclear Physics", "Semiconductors", "Communication System", "Experimental Physics"],
                chemistry: ["Some Basic Concepts of Chemistry", "Structure of Atom", "Classification of Elements and Periodicity in Properties", "Chemical Bonding and Molecular Structure", "States of Matter", "Thermodynamics (C)", 
                    "Chemical Equilibrium", "Ionic Equilibrium", "Redox Reactions", "Hydrogen", "s Block Elements", "p Block Elements (Group 13 & 14)", 
                    "General Organic Chemistry", "Hydrocarbons", "Environmental Chemistry", "Solid State", "Solutions", "Electrochemistry", "Chemical Kinetics", 
                    "Surface Chemistry", "General Principles and Processes of Isolation of Metals", "p Block Elements (Group 15, 16, 17 & 18)", "d and f Block Elements", 
                    "Coordination Compounds", "Haloalkanes and Haloarenes", "Alcohols, Phenols and Ethers", "Aldehydes and Ketones", "Carboxylic Acid Derivatives", 
                    "Amines", "Biomolecules", "Polymers", "Chemistry in Everyday Life", "Practical Chemistry"],
                mathematics: ["Basic of Mathematics", "Quadratic Equation", "Complex Number", "Permutation Combination", "Sequences and Series", "Mathematical Induction", 
                    "Binomial Theorem", "Trigonometric Ratios & Identities", "Trigonometric Equations", "Straight Lines", "Pair of Lines", "Circle", "Parabola", "Ellipse", "Hyperbola", 
                    "Limits", "Mathematical Reasoning", "Statistics", "Heights and Distances", "Properties of Triangles", "Sets and Relations", "Matrices", "Determinants", 
                    "Inverse Trigonometric Functions", "Functions", "Continuity and Differentiability", "Differentiation", "Application of Derivatives", "Indefinite Integration", 
                    "Definite Integration", "Area Under Curves", "Differential Equations", "Vector Algebra", "Three Dimensional Geometry", "Linear Programming", "Probability"]
            };
            
            for (const subject of subjects) {
                try {
                    const examName = selectedExam === 'advanced' ? 'JEE Advanced' : 'JEE Main';
                    const subjectName = subject.charAt(0).toUpperCase() + subject.slice(1);
                    let totalQuestions = 0;
                    
                    // Update chapter count
                    const chapterCount = chapters[subject].length;
                    document.getElementById(`${subject}-chapters`).textContent = `${chapterCount} Chapters`;
                    
                    for (const chapter of chapters[subject]) {
                        const itemsSnapshot = await db.collection('questions').doc(examName).collection(subjectName).doc(chapter).collection('items').get();
                        totalQuestions += itemsSnapshot.size;
                    }
                    
                    document.getElementById(`${subject}-total`).textContent = `${totalQuestions} Questions`;
                } catch (error) {
                    document.getElementById(`${subject}-total`).textContent = '0 Questions';
                    document.getElementById(`${subject}-chapters`).textContent = '0 Chapters';
                }
            }
        }
        
        function loadChapters(subject) {
            const chapterGrid = document.getElementById('chapterGrid');
            chapterGrid.innerHTML = 'Loading chapters...';
            
            const chapters = {
                physics: ["Mathematics in Physics", "Units and Dimensions", "Motion In One Dimension", "Motion In Two Dimensions", "Laws of Motion", "Work Power Energy", 
                    "Center of Mass Momentum and Collision", "Rotational Motion", "Gravitation", "Mechanical Properties of Solids", "Mechanical Properties of Fluids", "Thermal Properties of Matter", 
                    "Thermodynamics", "Kinetic Theory of Gases", "Oscillations", "Waves and Sound", "Electrostatics", "Capacitance", "Current Electricity", 
                    "Magnetic Properties of Matter", "Magnetic Effects of Current", "Electromagnetic Induction", "Alternating Current", "Electromagnetic Waves", 
                    "Ray Optics", "Wave Optics", "Dual Nature of Matter", "Atomic Physics", "Nuclear Physics", "Semiconductors", "Communication System", "Experimental Physics"],
                chemistry: ["Some Basic Concepts of Chemistry", "Structure of Atom", "Classification of Elements and Periodicity in Properties", "Chemical Bonding and Molecular Structure", "States of Matter", "Thermodynamics (C)", 
                    "Chemical Equilibrium", "Ionic Equilibrium", "Redox Reactions", "Hydrogen", "s Block Elements", "p Block Elements (Group 13 & 14)", 
                    "General Organic Chemistry", "Hydrocarbons", "Environmental Chemistry", "Solid State", "Solutions", "Electrochemistry", "Chemical Kinetics", 
                    "Surface Chemistry", "General Principles and Processes of Isolation of Metals", "p Block Elements (Group 15, 16, 17 & 18)", "d and f Block Elements", 
                    "Coordination Compounds", "Haloalkanes and Haloarenes", "Alcohols, Phenols and Ethers", "Aldehydes and Ketones", "Carboxylic Acid Derivatives", 
                    "Amines", "Biomolecules", "Polymers", "Chemistry in Everyday Life", "Practical Chemistry"],
                mathematics: ["Basic of Mathematics", "Quadratic Equation", "Complex Number", "Permutation Combination", "Sequences and Series", "Mathematical Induction", 
                    "Binomial Theorem", "Trigonometric Ratios & Identities", "Trigonometric Equations", "Straight Lines", "Pair of Lines", "Circle", "Parabola", "Ellipse", "Hyperbola", 
                    "Limits", "Mathematical Reasoning", "Statistics", "Heights and Distances", "Properties of Triangles", "Sets and Relations", "Matrices", "Determinants", 
                    "Inverse Trigonometric Functions", "Functions", "Continuity and Differentiability", "Differentiation", "Application of Derivatives", "Indefinite Integration", 
                    "Definite Integration", "Area Under Curves", "Differential Equations", "Vector Algebra", "Three Dimensional Geometry", "Linear Programming", "Probability"]
            };
            
            chapterGrid.innerHTML = '';
            
            if (!chapters[subject]) {
                chapterGrid.innerHTML = 'No chapters found for this subject.';
                return;
            }
            
            chapters[subject].forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = 'chapter-card';
                
                const chapterNumber = (index + 1).toString().padStart(2, '0');
                
                chapterCard.innerHTML = `
                    <div class="chapter-info">
                        <div class="chapter-icon">${chapterNumber}</div>
                        <div class="chapter-details">
                            <h4>${chapter}</h4>
                            <p class="chapter-subtitle">${subject.charAt(0).toUpperCase() + subject.slice(1)} • Chapter ${index + 1}</p>
                        </div>
                    </div>
                    <span class="question-count">Loading...</span>
                `;
                chapterCard.onclick = () => selectChapter(chapter);
                chapterGrid.appendChild(chapterCard);
                
                loadQuestionCount(chapter, chapterCard);
            });
        }
        
        async function loadQuestionCount(chapter, chapterCard) {
            try {
                const examName = selectedExam === 'advanced' ? 'JEE Advanced' : 'JEE Main';
                const subjectName = selectedSubject.charAt(0).toUpperCase() + selectedSubject.slice(1);
                
                const snapshot = await db.collection('questions').doc(examName).collection(subjectName).doc(chapter).collection('items').get();
                const questionCount = snapshot.size;
                
                const countSpan = chapterCard.querySelector('.question-count');
                countSpan.textContent = `${questionCount} questions`;
            } catch (error) {
                const countSpan = chapterCard.querySelector('.question-count');
                countSpan.textContent = '0 questions';
            }
        }
        
        function selectChapter(chapter) {
            localStorage.setItem('selectedChapter', chapter);
            document.getElementById('chapterSelection').style.display = 'none';
            document.getElementById('questionsSection').style.display = 'block';
            loadQuestions(chapter);
        }
        
        async function loadQuestions(chapter) {
            const questionsList = document.getElementById('questionsList');
            questionsList.innerHTML = 'Loading questions...';
            
            try {
                const examName = selectedExam === 'advanced' ? 'JEE Advanced' : 'JEE Main';
                const subjectName = selectedSubject.charAt(0).toUpperCase() + selectedSubject.slice(1);
                
                const itemsSnapshot = await db.collection('questions').doc(examName).collection(subjectName).doc(chapter).collection('items').get();
                
                questionsList.innerHTML = '';
                
                if (itemsSnapshot.empty) {
                    questionsList.innerHTML = 'No questions found for this chapter.';
                    return;
                }
                
                const questions = [];
                itemsSnapshot.forEach((doc) => {
                    questions.push({id: doc.id, data: doc.data()});
                });
                
                questions.sort((a, b) => {
                    const timeA = a.data.createdAt || 0;
                    const timeB = b.data.createdAt || 0;
                    return timeB - timeA;
                });
                
                let questionCounter = 1;
                questions.forEach((item) => {
                    const doc = item;
                    const question = item.data;

                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question-item';
                    
                    let imageHtml = '';
                    if (question.questionImage) {
                        imageHtml = `<img src="${question.questionImage}">`;
                    }
                    
                    const paperInfo = question.examId || 'Unknown Paper';
                    const year = paperInfo.match(/(202[0-9])/) ? paperInfo.match(/(202[0-9])/)[1] : 'Unknown Year';
                    
                    questionDiv.innerHTML = `
                        <div class="question-header">
                            <div class="question-number">Question ${questionCounter}</div>
                        </div>
                        <div class="question-content">
                            ${imageHtml}
                            <div class="question-meta">
                                <div class="meta-item">
                                    <span class="meta-icon">📄</span>
                                    <span>${paperInfo}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-icon">📅</span>
                                    <span>${year}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    questionsList.appendChild(questionDiv);
                    questionCounter++;
                });
            } catch (error) {
                questionsList.innerHTML = 'Error loading questions: ' + error.message;
            }
        }
        

        
        function showExamPanels() {
            localStorage.removeItem('selectedExam');
            localStorage.removeItem('selectedSubject');
            localStorage.removeItem('selectedChapter');
            document.getElementById('subjectSelection').style.display = 'none';
            document.getElementById('examPanels').style.display = 'grid';
        }
        
        function showSubjectSelection() {
            localStorage.removeItem('selectedSubject');
            localStorage.removeItem('selectedChapter');
            document.getElementById('chapterSelection').style.display = 'none';
            document.getElementById('subjectSelection').style.display = 'block';
        }
        
        function showChapterSelection() {
            localStorage.removeItem('selectedChapter');
            document.getElementById('questionsSection').style.display = 'none';
            document.getElementById('chapterSelection').style.display = 'block';
        }
    </script>
</body>
</html>
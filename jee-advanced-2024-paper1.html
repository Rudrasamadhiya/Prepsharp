<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE Advanced 2024 Paper 1 - PrepSharp Admin</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary-color: #1976d2;
            --secondary-color: #42a5f5;
            --background-color: #f5f5f5;
            --text-color: #212121;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .container {
            max-width: 800px;
            margin: 30px auto;
            padding: 0 20px;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        h1, h2, h3 { color: var(--primary-color); }
        .question-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            background-color: white;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        .question-number {
            font-weight: bold;
            font-size: 18px;
        }
        .question-type {
            color: #1976d2;
            font-weight: 500;
        }
        .question-text {
            margin-bottom: 20px;
        }
        .question-image {
            max-width: 60%;
            margin-bottom: 20px;
        }
        .options-container {
            margin-bottom: 20px;
        }
        .option {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        .option:hover {
            background-color: #f9f9f9;
        }
        .option.selected {
            background-color: #e3f2fd;
            border: 1px solid #1976d2;
        }
        .option-label {
            margin-right: 10px;
            font-weight: bold;
            min-width: 25px;
        }
        .option-image {
            max-width: 50%;
        }
        .option-text {
            flex-grow: 1;
        }
        .btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background-color: var(--secondary-color);
        }
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid #28a745;
            display: none;
        }
        .explanation-text {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Segoe UI', sans-serif;
            resize: vertical;
        }
        .show-explanation {
            margin-top: 10px;
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: underline;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .question-meta {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .meta-row {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
        .meta-col {
            flex: 1;
        }
        .integer-input {
            width: 200px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <header>
        <h2>PrepSharp - JEE Advanced 2024 Paper 1</h2>
        <div>
            <button id="dashboard-btn" class="btn">Dashboard</button>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <h1>JEE Advanced 2024: Paper 1</h1>
            
            <div class="marking-info" style="background-color: #f8f9fa; border-left: 4px solid #1976d2; padding: 15px; margin-bottom: 20px;">
                <h3>Paper Pattern:</h3>
                <ul>
                    <li>Subjects: Physics, Chemistry, Mathematics</li>
                    <li>Questions per Subject: 17</li>
                    <li>Total Questions: 51</li>
                </ul>
                <h3>Question Types:</h3>
                <ul>
                    <li>Single correct option MCQs (4 questions/per subject)</li>
                    <li>Multiple correct options MCQs (3 questions/per subject)</li>
                    <li>Non-Negative Integer Type questions (6 questions/per subject)</li>
                    <li>Match List type questions (4 questions/per subject)</li>
                </ul>
                <h3>Marking Scheme:</h3>
                <ul>
                    <li>Single correct: +3 for correct, -1 for incorrect</li>
                    <li>Multiple correct: +4 for all correct, partial marks for partially correct, -2 for incorrect</li>
                    <li>Non-Negative Integer: +4 for correct, 0 for incorrect</li>
                    <li>Match List: +3 for correct, -1 for incorrect</li>
                </ul>
            </div>
            
            <div class="tab-container">
                <div class="tab active" data-subject="physics">Physics</div>
                <div class="tab" data-subject="chemistry">Chemistry</div>
                <div class="tab" data-subject="mathematics">Mathematics</div>
            </div>
            
            <!-- Physics Tab -->
            <div id="physics-tab" class="tab-content active">
                <h2>Physics Questions</h2>
                <div id="physics-questions"></div>
            </div>
            
            <!-- Chemistry Tab -->
            <div id="chemistry-tab" class="tab-content">
                <h2>Chemistry Questions</h2>
                <div id="chemistry-questions"></div>
            </div>
            
            <!-- Mathematics Tab -->
            <div id="mathematics-tab" class="tab-content">
                <h2>Mathematics Questions</h2>
                <div id="mathematics-questions"></div>
            </div>
        </div>
    </div>

    <div class="container" style="text-align: center; margin-top: 30px;">
        <button id="save-paper-btn" class="btn" style="background-color: #1976d2;">Save Paper</button>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCtkee-Lv8lEMestaSVJxx7yvKB-lBygPQ",
            authDomain: "prepsharp-c91fd.firebaseapp.com",
            projectId: "prepsharp-c91fd",
            storageBucket: "prepsharp-c91fd.firebasestorage.app",
            messagingSenderId: "688294848433",
            appId: "1:688294848433:web:dd93fc6d61d62392473f90"
        };
        
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }
        
        // Chapter data by subject
        const chaptersBySubject = {
            "Physics": [
                "Mathematics in Physics", "Units and Dimensions", "Motion In One Dimension", "Motion In Two Dimensions", "Laws of Motion", "Work Power Energy", 
                "Center of Mass Momentum and Collision", "Rotational Motion", "Gravitation", "Mechanical Properties of Solids", "Mechanical Properties of Fluids", "Thermal Properties of Matter", 
                "Thermodynamics", "Kinetic Theory of Gases", "Oscillations", "Waves and Sound", "Electrostatics", "Capacitance", "Current Electricity", 
                "Magnetic Properties of Matter", "Magnetic Effects of Current", "Electromagnetic Induction", "Alternating Current", "Electromagnetic Waves", 
                "Ray Optics", "Wave Optics", "Dual Nature of Matter", "Atomic Physics", "Nuclear Physics", "Semiconductors", "Communication System", "Experimental Physics"
            ],
            "Chemistry": [
                "Some Basic Concepts of Chemistry", "Structure of Atom", "Classification of Elements and Periodicity in Properties", "Chemical Bonding and Molecular Structure", "States of Matter", "Thermodynamics (C)", 
                "Chemical Equilibrium", "Ionic Equilibrium", "Redox Reactions", "Hydrogen", "s Block Elements", "p Block Elements (Group 13 & 14)", 
                "General Organic Chemistry", "Hydrocarbons", "Environmental Chemistry", "Solid State", "Solutions", "Electrochemistry", "Chemical Kinetics", 
                "Surface Chemistry", "General Principles and Processes of Isolation of Metals", "p Block Elements (Group 15, 16, 17 & 18)", "d and f Block Elements", 
                "Coordination Compounds", "Haloalkanes and Haloarenes", "Alcohols, Phenols and Ethers", "Aldehydes and Ketones", "Carboxylic Acid Derivatives", 
                "Amines", "Biomolecules", "Polymers", "Chemistry in Everyday Life", "Practical Chemistry"
            ],
            "Mathematics": [
                "Basic of Mathematics", "Quadratic Equation", "Complex Number", "Permutation Combination", "Sequences and Series", "Mathematical Induction", 
                "Binomial Theorem", "Trigonometric Ratios & Identities", "Trigonometric Equations", "Straight Lines", "Pair of Lines", "Circle", "Parabola", "Ellipse", "Hyperbola", 
                "Limits", "Mathematical Reasoning", "Statistics", "Heights and Distances", "Properties of Triangles", "Sets and Relations", "Matrices", "Determinants", 
                "Inverse Trigonometric Functions", "Functions", "Continuity and Differentiability", "Differentiation", "Application of Derivatives", "Indefinite Integration", 
                "Definite Integration", "Area Under Curves", "Differential Equations", "Vector Algebra", "Three Dimensional Geometry", "Linear Programming", "Probability"
            ]
        };
        
        // Generate questions with form fields
        function generateQuestions(subject) {
            let html = '';
            const questionsPerType = {
                'Single Correct Option': 4,
                'Multiple Correct Options': 3,
                'Non-Negative Integer': 6,
                'Match List': 4
            };
            
            let questionNumber = 1;
            
            Object.entries(questionsPerType).forEach(([type, count]) => {
                for (let i = 0; i < count; i++) {
                    html += `
                        <div class="question-container" data-question="${questionNumber}" data-subject="${subject}" data-type="${type}">
                            <div class="question-header">
                                <span class="question-number">Question ${questionNumber}</span>
                                <span class="question-type">${type}</span>
                            </div>
                            
                            <div class="question-meta">
                                <div class="meta-row">
                                    <div class="meta-col">
                                        <label>Chapter:</label>
                                        <select class="form-control chapter-select" multiple size="3">
                                            ${chaptersBySubject[subject].map(ch => `<option value="${ch}">${ch}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div class="meta-col">
                                        <label>Difficulty:</label>
                                        <select class="form-control difficulty-select">
                                            <option value="">Select Difficulty</option>
                                            <option value="Easy">Easy</option>
                                            <option value="Medium">Medium</option>
                                            <option value="Hard">Hard</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="meta-row">
                                    <div class="meta-col">
                                        <label>Marks:</label>
                                        <input type="number" class="form-control marks-input" value="${type === 'Single Correct Option' ? '3' : type === 'Multiple Correct Options' || type === 'Non-Negative Integer' ? '4' : '3'}" min="1">
                                    </div>
                                    <div class="meta-col">
                                        <label>Negative Marks:</label>
                                        <input type="number" class="form-control negative-marks-input" value="${type === 'Single Correct Option' ? '-1' : type === 'Multiple Correct Options' ? '-2' : '0'}" step="0.1">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="question-text">
                                <img src="papers/2024-1/${subject === 'Mathematics' ? 'Maths' : subject}/Question-${questionNumber}.png" alt="Question ${questionNumber}" class="question-image">
                            </div>
                            
                            ${type === 'Non-Negative Integer' ? `
                                <div class="form-group">
                                    <label>Correct Answer:</label>
                                    <input type="number" class="integer-input correct-answer" placeholder="Enter correct answer" min="0">
                                </div>
                            ` : `
                                <div class="options-container">
                                    ${['A', 'B', 'C', 'D'].map((opt, idx) => `
                                        <div class="option" data-option="${opt}">
                                            <span class="option-label">${opt}.</span>
                                            <div class="option-text">
                                                <img src="papers/2024-1/${subject === 'Mathematics' ? 'Maths' : subject}/Question-${questionNumber} Option-${idx + 1}.png" alt="Option ${opt}" class="option-image">
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                            
                            <div class="show-explanation" onclick="toggleExplanation('explanation-${questionNumber}')">
                                Add Explanation
                            </div>
                            <div class="explanation" id="explanation-${questionNumber}">
                                <textarea class="explanation-text" placeholder="Enter explanation for this question..."></textarea>
                            </div>
                            <div style="margin-top: 15px; text-align: right;">
                                <button class="btn" onclick="saveIndividualQuestion(${questionNumber})" style="background-color: #28a745; font-size: 14px; padding: 8px 16px;">Save Question ${questionNumber}</button>
                            </div>
                        </div>
                    `;
                    questionNumber++;
                }
            });
            
            return html;
        }
        
        // Generate all questions when page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('physics-questions').innerHTML = generateQuestions('Physics');
            document.getElementById('chemistry-questions').innerHTML = generateQuestions('Chemistry');
            document.getElementById('mathematics-questions').innerHTML = generateQuestions('Mathematics');
        });
        
        // Tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                const subject = this.getAttribute('data-subject');
                document.getElementById(`${subject}-tab`).classList.add('active');
            });
        });
        
        // Dashboard button
        document.getElementById('dashboard-btn').addEventListener('click', function() {
            window.location.href = 'dashboard.html';
        });
        
        // Toggle explanation textarea
        function toggleExplanation(id) {
            const explanation = document.getElementById(id);
            if (explanation.style.display === 'block') {
                explanation.style.display = 'none';
            } else {
                explanation.style.display = 'block';
            }
        }
        
        // Option selection (for marking correct answers)
        document.addEventListener('click', function(e) {
            if (e.target.closest('.option')) {
                const option = e.target.closest('.option');
                const questionContainer = option.closest('.question-container');
                const questionType = questionContainer.querySelector('.question-type').textContent;
                
                if (questionType === 'Single Correct Option') {
                    // Remove selected class from all options in this question
                    questionContainer.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // Add selected class to clicked option
                    option.classList.add('selected');
                } else if (questionType === 'Multiple Correct Options') {
                    // Toggle selected class for multiple correct options
                    option.classList.toggle('selected');
                } else if (questionType === 'Match List') {
                    // Remove selected class from all options in this question
                    questionContainer.querySelectorAll('.option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    // Add selected class to clicked option
                    option.classList.add('selected');
                }
            }
        });
        
        // Save paper button
        document.getElementById('save-paper-btn').addEventListener('click', async function() {
            if (!db) {
                alert('Firebase not initialized');
                return;
            }
            
            const examId = "jee-advanced-2024-paper1";
            let savedCount = 0;
            let totalQuestions = 0;
            
            // Collect and save all questions
            const allQuestions = document.querySelectorAll('.question-container');
            totalQuestions = allQuestions.length;
            
            for (const questionContainer of allQuestions) {
                const questionNumber = questionContainer.getAttribute('data-question');
                const subject = questionContainer.getAttribute('data-subject');
                const questionType = questionContainer.getAttribute('data-type');
                
                // Get form values
                const chapterSelect = questionContainer.querySelector('.chapter-select');
                const chapters = Array.from(chapterSelect.selectedOptions).map(option => option.value);
                const difficulty = questionContainer.querySelector('.difficulty-select').value;
                const marks = questionContainer.querySelector('.marks-input').value;
                const negativeMarks = questionContainer.querySelector('.negative-marks-input').value;
                const explanation = questionContainer.querySelector('.explanation-text').value;
                
                if (chapters.length === 0 || !difficulty) {
                    alert(`Please select chapter(s) and difficulty for Question ${questionNumber}`);
                    return;
                }
                
                // Create question object
                const question = {
                    id: `question-${questionNumber}`,
                    text: 'See image',
                    type: questionType === 'Single Correct Option' ? 'mcq-single' : 
                          questionType === 'Multiple Correct Options' ? 'mcq-multiple' :
                          questionType === 'Non-Negative Integer' ? 'numerical' : 'match-list',
                    subject: subject,
                    chapters: chapters,
                    difficulty: difficulty,
                    marks: parseInt(marks),
                    negativeMarks: parseFloat(negativeMarks),
                    examId: examId,
                    createdAt: Date.now(),
                    sectionName: `${subject} - ${questionType}`,
                    explanation: explanation
                };
                
                // Add type-specific data
                if (questionType === 'Non-Negative Integer') {
                    const correctAnswer = questionContainer.querySelector('.correct-answer').value;
                    if (!correctAnswer) {
                        alert(`Please enter correct answer for Question ${questionNumber}`);
                        return;
                    }
                    question.answer = correctAnswer;
                } else {
                    // For MCQ questions
                    const selectedOptions = questionContainer.querySelectorAll('.option.selected');
                    if (selectedOptions.length === 0) {
                        alert(`Please select correct option(s) for Question ${questionNumber}`);
                        return;
                    }
                    
                    question.options = ['A', 'B', 'C', 'D'];
                    
                    if (questionType === 'Single Correct Option') {
                        const correctOption = selectedOptions[0].getAttribute('data-option');
                        question.correctOption = ['A', 'B', 'C', 'D'].indexOf(correctOption);
                    } else if (questionType === 'Multiple Correct Options') {
                        question.correctOptions = [false, false, false, false];
                        selectedOptions.forEach(opt => {
                            const optionIndex = ['A', 'B', 'C', 'D'].indexOf(opt.getAttribute('data-option'));
                            question.correctOptions[optionIndex] = true;
                        });
                    }
                }
                
                try {
                    // Save to papers collection
                    await db.collection('papers').doc(examId).collection('questions').doc(`question-${questionNumber}`).set(question);
                    
                    // Save to each selected chapter
                    const globalQuestionId = `${examId}-question-${questionNumber}`;
                    for (const chapter of chapters) {
                        await db.collection('questions')
                            .doc('jee-advanced')
                            .collection(subject)
                            .doc(chapter)
                            .collection('items')
                            .doc(globalQuestionId)
                            .set({...question, globalQuestionId, paperId: examId});
                    }
                    
                    savedCount++;
                } catch (error) {
                    console.error(`Error saving question ${questionNumber}:`, error);
                    alert(`Error saving question ${questionNumber}`);
                    return;
                }
            }
            
            // Save exam metadata
            try {
                await db.collection('papers').doc(examId).set({
                    id: examId,
                    name: "JEE Advanced 2024: Paper 1",
                    type: "jee-advanced",
                    year: "2024",
                    paperNumber: "1",
                    subjects: ["Physics", "Chemistry", "Mathematics"],
                    totalQuestions: totalQuestions,
                    createdAt: Date.now()
                }, { merge: true });
                
                alert(`Paper saved successfully!\n${savedCount} questions saved to Firebase.`);
            } catch (error) {
                console.error('Error saving exam metadata:', error);
                alert('Questions saved but error saving exam metadata');
            }
        });
        
        // Save individual question function
        window.saveIndividualQuestion = async function(questionNumber) {
            if (!db) {
                alert('Firebase not initialized');
                return;
            }
            
            const examId = "jee-advanced-2024-paper1";
            const questionContainer = document.querySelector(`[data-question="${questionNumber}"]`);
            
            if (!questionContainer) {
                alert('Question not found');
                return;
            }
            
            const subject = questionContainer.getAttribute('data-subject');
            const questionType = questionContainer.getAttribute('data-type');
            
            // Get form values
            const chapterSelect = questionContainer.querySelector('.chapter-select');
            const chapters = Array.from(chapterSelect.selectedOptions).map(option => option.value);
            const difficulty = questionContainer.querySelector('.difficulty-select').value;
            const marks = questionContainer.querySelector('.marks-input').value;
            const negativeMarks = questionContainer.querySelector('.negative-marks-input').value;
            const explanation = questionContainer.querySelector('.explanation-text').value;
            
            if (chapters.length === 0 || !difficulty) {
                alert(`Please select chapter(s) and difficulty for Question ${questionNumber}`);
                return;
            }
            
            // Create question object
            const question = {
                id: `question-${questionNumber}`,
                text: 'See image',
                type: questionType === 'Single Correct Option' ? 'mcq-single' : 
                      questionType === 'Multiple Correct Options' ? 'mcq-multiple' :
                      questionType === 'Non-Negative Integer' ? 'numerical' : 'match-list',
                subject: subject,
                chapters: chapters,
                difficulty: difficulty,
                marks: parseInt(marks),
                negativeMarks: parseFloat(negativeMarks),
                examId: examId,
                createdAt: Date.now(),
                sectionName: `${subject} - ${questionType}`,
                explanation: explanation
            };
            
            // Add type-specific data
            if (questionType === 'Non-Negative Integer') {
                const correctAnswer = questionContainer.querySelector('.correct-answer').value;
                if (!correctAnswer) {
                    alert(`Please enter correct answer for Question ${questionNumber}`);
                    return;
                }
                question.answer = correctAnswer;
            } else {
                // For MCQ questions
                const selectedOptions = questionContainer.querySelectorAll('.option.selected');
                if (selectedOptions.length === 0) {
                    alert(`Please select correct option(s) for Question ${questionNumber}`);
                    return;
                }
                
                question.options = ['A', 'B', 'C', 'D'];
                
                if (questionType === 'Single Correct Option') {
                    const correctOption = selectedOptions[0].getAttribute('data-option');
                    question.correctOption = ['A', 'B', 'C', 'D'].indexOf(correctOption);
                } else if (questionType === 'Multiple Correct Options') {
                    question.correctOptions = [false, false, false, false];
                    selectedOptions.forEach(opt => {
                        const optionIndex = ['A', 'B', 'C', 'D'].indexOf(opt.getAttribute('data-option'));
                        question.correctOptions[optionIndex] = true;
                    });
                }
            }
            
            try {
                // Save to papers collection
                await db.collection('papers').doc(examId).collection('questions').doc(`question-${questionNumber}`).set(question);
                
                // Save to each selected chapter
                const globalQuestionId = `${examId}-question-${questionNumber}`;
                for (const chapter of chapters) {
                    await db.collection('questions')
                        .doc('jee-advanced')
                        .collection(subject)
                        .doc(chapter)
                        .collection('items')
                        .doc(globalQuestionId)
                        .set({...question, globalQuestionId, paperId: examId});
                }
                
                alert(`Question ${questionNumber} saved to ${chapters.length} chapter(s) successfully!`);
            } catch (error) {
                console.error(`Error saving question ${questionNumber}:`, error);
                alert(`Error saving question ${questionNumber}`);
            }
        };
    </script>
</body>
</html>
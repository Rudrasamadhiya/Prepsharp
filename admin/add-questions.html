<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Questions - PrepSharp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="../images/logo.png">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f6f9fc, #f1f5f9);
            overflow-x: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 250px;
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: white;
            z-index: 1000;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-header {
            padding: 25px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 10px;
        }
        
        .sidebar-header img {
            height: 60px;
            margin-bottom: 12px;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
        }
        
        .sidebar-header h5 {
            font-weight: 700;
            font-size: 18px;
            letter-spacing: 0.5px;
            background: linear-gradient(to right, #f97316, #fb923c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        
        .sidebar-menu {
            padding: 0;
            list-style: none;
            margin: 15px 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
            padding: 0 10px;
        }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.05));
            color: #f97316;
            transform: translateX(5px);
        }
        
        .sidebar-menu a.active {
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.3), rgba(249, 115, 22, 0.1));
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            color: #f97316;
            font-weight: 600;
        }
        
        .sidebar-menu i {
            margin-right: 12px;
            font-size: 18px;
            width: 25px;
            text-align: center;
        }
        
        /* Sidebar Footer */
        .sidebar-footer {
            padding: 15px;
            position: absolute;
            bottom: 0;
            width: 100%;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
            background: rgba(239, 68, 68, 0.15);
        }
        
        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.25);
            color: #ef4444;
            transform: translateY(-3px);
        }
        
        .logout-btn i {
            margin-right: 10px;
            font-size: 18px;
        }
        
        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        /* Top Navbar */
        .top-navbar {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            padding: 18px 30px;
            margin-bottom: 25px;
            border-radius: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 8px 20px 8px 8px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            z-index: 10;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 15px;
            background: linear-gradient(135deg, #f97316, #c2410c);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(249, 115, 22, 0.3);
            position: relative;
            z-index: 2;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
        }
        
        .user-name {
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            font-size: 15px;
            letter-spacing: 0.5px;
        }
        
        .user-role {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            background: linear-gradient(90deg, #f97316, #fb923c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 500;
        }
        
        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            border: none;
            overflow: hidden;
            position: relative;
        }
        
        .card-header {
            background: linear-gradient(135deg, #4f46e5, #8b5cf6);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Form Styling */
        .form-label {
            font-weight: 500;
            color: #4f46e5;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            padding: 10px 15px;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25);
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #8b5cf6);
            border: none;
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.25);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #4338ca, #7c3aed);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(79, 70, 229, 0.3);
        }
        
        .btn-outline-primary {
            color: #4f46e5;
            border-color: #4f46e5;
        }
        
        .btn-outline-primary:hover {
            background-color: #4f46e5;
            color: white;
        }
        
        .section-btn.active {
            background-color: #4f46e5;
            color: white;
            box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25);
        }
        
        /* Option Styling */
        .option-container {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }
        
        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .option-label {
            font-weight: 600;
            color: #4f46e5;
        }
        
        /* Loading Spinner */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px 0;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                left: -250px;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .main-content.active {
                margin-left: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="../images/logo.png" alt="PrepSharp Logo">
            <h5>PrepSharp Admin</h5>
        </div>
        <ul class="sidebar-menu">
            <li><a href="collaborate-dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
            <li><a href="collaborate-exams.html"><i class="fas fa-file-alt"></i> Manage Exams</a></li>
            <li><a href="add-questions.html" class="active"><i class="fas fa-question-circle"></i> Add Questions</a></li>
            <li><a href="review-content.html"><i class="fas fa-check-circle"></i> Review Content</a></li>
            <li><a href="student-doubts.html"><i class="fas fa-comment-alt"></i> Student Doubts</a></li>
            <li><a href="my-profile.html"><i class="fas fa-user"></i> My Profile</a></li>
        </ul>
        <div class="sidebar-footer">
            <a href="#" id="sidebar-logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        <div class="top-navbar">
            <div class="dashboard-title">
                <h2 style="color: white; margin: 0;">Add Questions</h2>
            </div>
            <div class="d-flex align-items-center">
                <button id="pdf-btn" class="btn btn-success me-3">
                    <i class="fas fa-file-pdf me-1"></i> Upload PDF
                </button>
            </div>
            <div class="user-menu">
                <div class="user-profile">
                    <div class="user-avatar" id="user-initial">A</div>
                    <div class="user-info">
                        <div class="user-name" id="admin-name">Admin</div>
                        <div class="user-role">Content Admin</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-container" class="loading-container" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading exam details...</p>
        </div>

        <!-- Add Question Form -->
        <div id="add-question-form" style="display: block;">
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Add Question to <span id="exam-name" style="color: white;">Loading...</span></h5>
                    <div>
                        <a href="#" id="back-to-exam" class="btn btn-sm btn-light">
                            <i class="fas fa-arrow-left me-1"></i> Back
                        </a>
                    </div>
                </div>
                <div class="card-body bg-light p-2 mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <span id="question-number" class="badge bg-primary me-3">Question 1 of 75</span>
                            <span id="section-name" class="badge bg-secondary">Physics - Section 1</span>
                        </div>
                    </div>
                    <!-- Section Navigation -->
                    <div class="section-navigation mt-3">
                        <div class="btn-group btn-group-sm mb-2">
                            <button type="button" class="btn btn-outline-primary section-btn" onclick="return jumpToSection(0)">Physics - MCQ</button>
                            <button type="button" class="btn btn-outline-primary section-btn" onclick="return jumpToSection(1)">Physics - Numerical</button>
                            <button type="button" class="btn btn-outline-primary section-btn" onclick="return jumpToSection(2)">Chemistry - MCQ</button>
                            <button type="button" class="btn btn-outline-primary section-btn" onclick="return jumpToSection(3)">Chemistry - Numerical</button>
                            <button type="button" class="btn btn-outline-primary section-btn" onclick="return jumpToSection(4)">Mathematics - MCQ</button>
                            <button type="button" class="btn btn-outline-primary section-btn" onclick="return jumpToSection(5)">Mathematics - Numerical</button>
                        </div>
                    </div>
                    <!-- Hidden fields for question type and subject -->
                    <select id="question-type" class="form-select form-select-sm d-none">
                        <option value="mcq-single">Single Correct Option</option>
                        <option value="mcq-multiple">Multiple Correct Options</option>
                        <option value="numerical">Numerical Answer</option>
                        <option value="match-list">Match List</option>
                    </select>
                </div>
                <div class="card-body">
                    <form id="question-form">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="question-subject" class="form-label">Subject</label>
                                    <select class="form-select d-none" id="question-subject" required>
                                        <option value="Physics">Physics</option>
                                        <option value="Chemistry">Chemistry</option>
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="Biology">Biology</option>
                                    </select>
                                    <div class="form-control" id="subject-display">Physics</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="question-chapter" class="form-label">Chapter</label>
                                    <select class="form-select" id="question-chapter" required>
                                        <option value="">Select Chapter</option>
                                        <!-- Physics chapters -->
                                        <option value="Mechanics">Mechanics</option>
                                        <option value="Kinematics">Kinematics</option>
                                        <option value="Laws of Motion">Laws of Motion</option>
                                        <option value="Work, Energy and Power">Work, Energy and Power</option>
                                        <option value="Rotational Motion">Rotational Motion</option>
                                        <option value="Gravitation">Gravitation</option>
                                        <option value="Properties of Solids and Liquids">Properties of Solids and Liquids</option>
                                        <option value="Thermodynamics">Thermodynamics</option>
                                        <option value="Kinetic Theory of Gases">Kinetic Theory of Gases</option>
                                        <option value="Oscillations and Waves">Oscillations and Waves</option>
                                        <option value="Electrostatics">Electrostatics</option>
                                        <option value="Current Electricity">Current Electricity</option>
                                        <option value="Magnetic Effects of Current">Magnetic Effects of Current</option>
                                        <option value="Magnetism">Magnetism</option>
                                        <option value="Electromagnetic Induction">Electromagnetic Induction</option>
                                        <option value="Alternating Current">Alternating Current</option>
                                        <option value="Electromagnetic Waves">Electromagnetic Waves</option>
                                        <option value="Optics">Optics</option>
                                        <option value="Dual Nature of Matter and Radiation">Dual Nature of Matter and Radiation</option>
                                        <option value="Atoms and Nuclei">Atoms and Nuclei</option>
                                        <option value="Electronic Devices">Electronic Devices</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="question-difficulty" class="form-label">Difficulty</label>
                                    <select class="form-select" id="question-difficulty" required>
                                        <option value="">Select Difficulty</option>
                                        <option value="Easy">Easy</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Hard">Hard</option>
                                        <option value="Very Hard">Very Hard</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="question-text" class="form-label">Question Text</label>
                            <textarea class="form-control" id="question-text" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="question-image" class="form-label">Question Image (Optional)</label>
                            <div class="d-flex">
                                <input type="file" class="form-control me-2" id="question-image" accept="image/*">
                                <button type="button" class="btn btn-success" id="capture-question-btn">Capture</button>
                            </div>
                            <div id="question-image-preview" class="mt-2" style="max-width: 300px; display: none;">
                                <img id="question-image-preview-img" class="img-fluid rounded" src="">
                                <button type="button" class="btn btn-sm btn-danger mt-1" onclick="removeQuestionImage()">Remove Image</button>
                            </div>
                        </div>
                        
                        <!-- MCQ Options -->
                        <div id="mcq-options" style="display: none;">
                            <h6 class="mb-3">Options</h6>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option A</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="correct-option" id="option-a-correct" value="0">
                                        <label class="form-check-label" for="option-a-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="option-a-text" rows="2"></textarea>
                                <div class="mt-2">
                                    <label for="option-a-image" class="form-label">Option Image (Optional)</label>
                                    <div class="d-flex">
                                        <input type="file" class="form-control me-2" id="option-a-image" accept="image/*">
                                        <button type="button" class="btn btn-success option-capture-btn" data-option="a">Capture</button>
                                    </div>
                                    <div id="option-a-image-preview" class="mt-2" style="max-width: 200px; display: none;">
                                        <img id="option-a-image-preview-img" class="img-fluid rounded" src="">
                                        <button type="button" class="btn btn-sm btn-danger mt-1" onclick="removeOptionImage('a')">Remove</button>
                                    </div>
                                </div>
                            </div>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option B</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="correct-option" id="option-b-correct" value="1">
                                        <label class="form-check-label" for="option-b-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="option-b-text" rows="2"></textarea>
                                <div class="mt-2">
                                    <label for="option-b-image" class="form-label">Option Image (Optional)</label>
                                    <div class="d-flex">
                                        <input type="file" class="form-control me-2" id="option-b-image" accept="image/*">
                                        <button type="button" class="btn btn-success option-capture-btn" data-option="b">Capture</button>
                                    </div>
                                    <div id="option-b-image-preview" class="mt-2" style="max-width: 200px; display: none;">
                                        <img id="option-b-image-preview-img" class="img-fluid rounded" src="">
                                        <button type="button" class="btn btn-sm btn-danger mt-1" onclick="removeOptionImage('b')">Remove</button>
                                    </div>
                                </div>
                            </div>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option C</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="correct-option" id="option-c-correct" value="2">
                                        <label class="form-check-label" for="option-c-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="option-c-text" rows="2"></textarea>
                                <div class="mt-2">
                                    <label for="option-c-image" class="form-label">Option Image (Optional)</label>
                                    <div class="d-flex">
                                        <input type="file" class="form-control me-2" id="option-c-image" accept="image/*">
                                        <button type="button" class="btn btn-success option-capture-btn" data-option="c">Capture</button>
                                    </div>
                                    <div id="option-c-image-preview" class="mt-2" style="max-width: 200px; display: none;">
                                        <img id="option-c-image-preview-img" class="img-fluid rounded" src="">
                                        <button type="button" class="btn btn-sm btn-danger mt-1" onclick="removeOptionImage('c')">Remove</button>
                                    </div>
                                </div>
                            </div>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option D</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="correct-option" id="option-d-correct" value="3">
                                        <label class="form-check-label" for="option-d-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="option-d-text" rows="2"></textarea>
                                <div class="mt-2">
                                    <label for="option-d-image" class="form-label">Option Image (Optional)</label>
                                    <div class="d-flex">
                                        <input type="file" class="form-control me-2" id="option-d-image" accept="image/*">
                                        <button type="button" class="btn btn-success option-capture-btn" data-option="d">Capture</button>
                                    </div>
                                    <div id="option-d-image-preview" class="mt-2" style="max-width: 200px; display: none;">
                                        <img id="option-d-image-preview-img" class="img-fluid rounded" src="">
                                        <button type="button" class="btn btn-sm btn-danger mt-1" onclick="removeOptionImage('d')">Remove</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Multiple Correct Options -->
                        <div id="multiple-options" style="display: none;">
                            <h6 class="mb-3">Options (Select all correct answers)</h6>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option A</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="multi-option-a-correct" value="0">
                                        <label class="form-check-label" for="multi-option-a-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="multi-option-a-text" rows="2"></textarea>
                            </div>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option B</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="multi-option-b-correct" value="1">
                                        <label class="form-check-label" for="multi-option-b-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="multi-option-b-text" rows="2"></textarea>
                            </div>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option C</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="multi-option-c-correct" value="2">
                                        <label class="form-check-label" for="multi-option-c-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="multi-option-c-text" rows="2"></textarea>
                            </div>
                            <div class="option-container">
                                <div class="option-header">
                                    <span class="option-label">Option D</span>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="multi-option-d-correct" value="3">
                                        <label class="form-check-label" for="multi-option-d-correct">Correct</label>
                                    </div>
                                </div>
                                <textarea class="form-control" id="multi-option-d-text" rows="2"></textarea>
                            </div>
                        </div>
                        
                        <!-- Numerical Answer -->
                        <div id="numerical-answer" style="display: none;">
                            <div class="mb-3">
                                <label for="numerical-value" class="form-label">Correct Answer</label>
                                <input type="text" class="form-control" id="numerical-value" placeholder="Enter the correct numerical value">
                            </div>
                        </div>
                        
                        <!-- Match List -->
                        <div id="match-list" style="display: none;">
                            <!-- Will be populated dynamically -->
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="question-marks" class="form-label">Marks</label>
                                    <input type="number" class="form-control" id="question-marks" min="1" value="4">
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary" id="prev-question-btn">
                                <i class="fas fa-arrow-left me-2"></i> Previous Question
                            </button>
                            <button type="button" class="btn btn-primary" id="save-question-btn">
                                <i class="fas fa-save me-2"></i> Save Question
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="next-question-btn">
                                <i class="fas fa-arrow-right me-2"></i> Next Question
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF Viewer Container -->
<div id="pdf-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); z-index: 2000; flex-direction: column;">
    <div class="pdf-controls" style="position: absolute; top: 10px; right: 10px; z-index: 1001;">
        <button id="close-pdf-btn" class="btn btn-danger">Close PDF</button>
    </div>
    <div id="pdf-viewer" style="height: 80%; width: 100%; overflow: auto;"></div>
    <div id="screenshot-area" style="height: 20%; background-color: #f5f5f5; border-top: 2px solid #4f46e5; padding: 10px; display: none; flex-direction: column; align-items: center; justify-content: center;">
        <p id="paste-instructions">Click and drag to select an area</p>
        <img id="screenshot-preview" style="display: none; max-height: 80%; max-width: 90%; margin-bottom: 10px;">
        <div id="screenshot-buttons" style="display: none;">
            <button id="use-for-question-btn" class="btn btn-primary">Use for Question</button>
            <button id="use-for-option-btn" class="btn btn-secondary">Use for Option</button>
            <button id="cancel-screenshot-btn" class="btn btn-danger">Cancel</button>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="exam-utils.js"></script>
    <script src="capture-utils.js"></script>
    <script src="jee-main-structure.js"></script>
    <script src="section-navigation.js"></script>
    <script src="jee-advanced-config.js"></script>
    <script src="folder-image-loader.js"></script>
    <script src="ensure-folder-button.js"></script>
    <script>
        // Current question index
        let currentQuestionIndex = 0;
        
        // Function to toggle question fields based on type
        function toggleQuestionFields() {
            const questionType = document.getElementById('question-type').value;
            
            // Hide all option containers
            document.getElementById('mcq-options').style.display = 'none';
            document.getElementById('multiple-options').style.display = 'none';
            document.getElementById('numerical-answer').style.display = 'none';
            document.getElementById('match-list').style.display = 'none';
            
            // Show the appropriate container based on question type
            if (questionType === 'mcq-single') {
                document.getElementById('mcq-options').style.display = 'block';
            } else if (questionType === 'mcq-multiple') {
                document.getElementById('multiple-options').style.display = 'block';
            } else if (questionType === 'numerical') {
                document.getElementById('numerical-answer').style.display = 'block';
            } else if (questionType === 'match-list') {
                document.getElementById('match-list').style.display = 'block';
            }
        }
        
        // Force show form immediately
        window.onload = function() {
            document.getElementById('loading-container').style.display = 'none';
            document.getElementById('add-question-form').style.display = 'block';
            
            // Format exam ID into a proper name
            const urlParams = new URLSearchParams(window.location.search);
            const examId = urlParams.get('examId') || 'exam-default';
            let examName = examId;
            if (examId.includes('jee-advanced')) {
                examName = examId.replace('jee-advanced-', 'JEE Advanced ').replace('paper', 'Paper ');
                examName = examName.replace(/-/g, ' ');
            } else if (examId.includes('jee-main')) {
                examName = examId.replace('jee-main---', 'JEE Main - ');
                examName = examName.replace(/-/g, ' ');
            }
            document.getElementById('exam-name').textContent = examName;
            document.getElementById('exam-name').style.fontWeight = 'bold';
            
            // Initialize based on exam type
            if (examId && examId.includes('jee-advanced')) {
                // For JEE Advanced, initialize with the advanced structure
                initializeAdvancedStructure(examId);
            } else {
                // For JEE Main, use the standard structure
                currentQuestionIndex = 0;
                updateQuestionFields();
                highlightCurrentSection();
            }
        };
    </script>
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCtkee-Lv8lEMestaSVJxx7yvKB-lBygPQ",
            authDomain: "prepsharp-c91fd.firebaseapp.com",
            projectId: "prepsharp-c91fd",
            storageBucket: "prepsharp-c91fd.firebasestorage.app",
            messagingSenderId: "688294848433",
            appId: "1:688294848433:web:dd93fc6d61d62392473f90",
            measurementId: "G-LLJSLMXMNY"
        };
        
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Skip login check for direct access
            // if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            //     window.location.href = "../login.html";
            //     return;
            // }
            
            // Set admin name and initial
            const adminName = sessionStorage.getItem('adminName') || 'Admin';
            const adminInitial = adminName.charAt(0).toUpperCase();
            document.getElementById('admin-name').textContent = adminName;
            document.getElementById('user-initial').textContent = adminInitial;
            
            // Get exam ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            let examId = urlParams.get('examId');
            
            if (!examId) {
                console.warn('No exam ID provided, using default');
                // Use a default ID instead of redirecting
                examId = "jee-main---31-jan-shift-2-2024";
            }
            
            // Show loading state
            document.getElementById('loading-container').style.display = 'flex';
            document.getElementById('add-question-form').style.display = 'none';
            
            // Validate paper existence before showing the form
            validatePaper(examId);
            
            // Check if this is a JEE Advanced paper and show configuration modal
            if (examId && examId.includes('jee-advanced')) {
                // Add a configure button next to the back button
                const backButtonContainer = document.querySelector('#back-to-exam').parentElement;
                const configButton = document.createElement('button');
                configButton.className = 'btn btn-sm btn-info ms-2';
                configButton.innerHTML = '<i class="fas fa-cog me-1"></i> Configure Sections';
                configButton.onclick = function() { showAdvancedConfigModal(examId); };
                backButtonContainer.appendChild(configButton);
                
                // Check if structure exists, if not show modal immediately
                const savedStructure = localStorage.getItem(`structure-${examId}`);
                if (!savedStructure) {
                    // Show the modal with a slight delay to ensure DOM is ready
                    setTimeout(() => showAdvancedConfigModal(examId), 500);
                } else {
                    // Initialize with saved structure
                    initializeAdvancedStructure(examId);
                }
            }
            
            // Set back link
            document.getElementById('back-to-exam').href = `edit-exam.html?id=${examId}`;
            
            // Format exam ID into a proper name
            let examName = examId;
            if (examId.includes('jee-advanced')) {
                examName = examId.replace('jee-advanced-', 'JEE Advanced ').replace('paper', 'Paper ');
                examName = examName.replace(/-/g, ' ');
            } else if (examId.includes('jee-main')) {
                examName = examId.replace('jee-main---', 'JEE Main - ');
                examName = examName.replace(/-/g, ' ');
            }
            document.getElementById('exam-name').textContent = examName;
            document.getElementById('exam-name').style.fontWeight = 'bold';
            
            // Initialize the question fields based on the first question
            currentQuestionIndex = 0;
            updateQuestionFields();
            
            // Highlight the first section button
            highlightCurrentSection();
            
            // Set up event listeners
            document.getElementById('sidebar-logout').addEventListener('click', function(e) {
                e.preventDefault();
                sessionStorage.removeItem('adminLoggedIn');
                window.location.href = "../login.html";
            });
            
            document.getElementById('save-question-btn').addEventListener('click', function() {
                saveQuestion(examId);
            });
            
            // Simplified navigation buttons
            document.getElementById('prev-question-btn').addEventListener('click', function() {
                if (examId && examId.includes('jee-advanced')) {
                    prevAdvancedQuestion();
                } else {
                    prevQuestion();
                }
            });
            
            document.getElementById('next-question-btn').addEventListener('click', function() {
                if (examId && examId.includes('jee-advanced')) {
                    nextAdvancedQuestion();
                } else {
                    nextQuestion();
                }
            });
        });
        
        // Function to load exam details - simplified to avoid Firebase errors
        function loadExamDetails(examId) {
            // Show form and hide loading immediately
            document.getElementById('loading-container').style.display = 'none';
            document.getElementById('add-question-form').style.display = 'block';
        }
        
        // Chapter data by subject
        const chaptersBySubject = {
            "Physics": [
                "Mechanics", "Kinematics", "Laws of Motion", "Work, Energy and Power", "Rotational Motion", 
                "Gravitation", "Properties of Solids and Liquids", "Thermodynamics", "Kinetic Theory of Gases", 
                "Oscillations and Waves", "Electrostatics", "Current Electricity", "Magnetic Effects of Current", 
                "Magnetism", "Electromagnetic Induction", "Alternating Current", "Electromagnetic Waves", 
                "Optics", "Dual Nature of Matter and Radiation", "Atoms and Nuclei", "Electronic Devices"
            ],
            "Chemistry": [
                "Basic Concepts", "States of Matter", "Atomic Structure", "Chemical Bonding", "Chemical Thermodynamics", 
                "Solutions", "Equilibrium", "Redox Reactions", "Electrochemistry", "Chemical Kinetics", 
                "Surface Chemistry", "Classification of Elements", "p-Block Elements", "d and f Block Elements", 
                "Coordination Compounds", "Environmental Chemistry", "Purification of Organic Compounds", 
                "Organic Compounds", "Hydrocarbons", "Haloalkanes and Haloarenes", "Alcohols, Phenols and Ethers", 
                "Aldehydes, Ketones and Carboxylic Acids", "Organic Compounds with Nitrogen", "Biomolecules", 
                "Polymers", "Chemistry in Everyday Life"
            ],
            "Mathematics": [
                "Sets, Relations and Functions", "Complex Numbers", "Matrices and Determinants", "Quadratic Equations", 
                "Permutations and Combinations", "Binomial Theorem", "Sequences and Series", "Limits and Continuity", 
                "Differentiation", "Applications of Derivatives", "Indefinite Integrals", "Definite Integrals", 
                "Applications of Integrals", "Differential Equations", "Straight Lines", "Circles", "Conic Sections", 
                "Three Dimensional Geometry", "Vector Algebra", "Statistics", "Probability", "Trigonometry", 
                "Mathematical Reasoning", "Mathematical Induction"
            ],
            "Biology": [
                "Diversity in Living World", "Structural Organization in Plants and Animals", "Cell Structure and Function", 
                "Plant Physiology", "Human Physiology", "Reproduction", "Genetics and Evolution", "Biology and Human Welfare", 
                "Biotechnology and its Applications", "Ecology and Environment"
            ]
        };
        
        // Simple function to update chapters based on selected subject
        function updateChapters(subject) {
            const chapterSelect = document.getElementById('question-chapter');
            chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
            
            if (subject === 'Physics') {
                const physicsChapters = ["Mechanics", "Kinematics", "Laws of Motion", "Work, Energy and Power", "Rotational Motion", 
                    "Gravitation", "Properties of Solids and Liquids", "Thermodynamics", "Kinetic Theory of Gases", 
                    "Oscillations and Waves", "Electrostatics", "Current Electricity", "Magnetic Effects of Current", 
                    "Magnetism", "Electromagnetic Induction", "Alternating Current", "Electromagnetic Waves", 
                    "Optics", "Dual Nature of Matter and Radiation", "Atoms and Nuclei", "Electronic Devices"];
                
                physicsChapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter;
                    option.textContent = chapter;
                    chapterSelect.appendChild(option);
                });
            } else if (subject === 'Chemistry') {
                const chemistryChapters = ["Basic Concepts", "States of Matter", "Atomic Structure", "Chemical Bonding", "Chemical Thermodynamics", 
                    "Solutions", "Equilibrium", "Redox Reactions", "Electrochemistry", "Chemical Kinetics", 
                    "Surface Chemistry", "Classification of Elements", "p-Block Elements", "d and f Block Elements", 
                    "Coordination Compounds", "Environmental Chemistry", "Purification of Organic Compounds", 
                    "Organic Compounds", "Hydrocarbons", "Haloalkanes and Haloarenes", "Alcohols, Phenols and Ethers", 
                    "Aldehydes, Ketones and Carboxylic Acids", "Organic Compounds with Nitrogen", "Biomolecules", 
                    "Polymers", "Chemistry in Everyday Life"];
                
                chemistryChapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter;
                    option.textContent = chapter;
                    chapterSelect.appendChild(option);
                });
            } else if (subject === 'Mathematics') {
                const mathChapters = ["Sets, Relations and Functions", "Complex Numbers", "Matrices and Determinants", "Quadratic Equations", 
                    "Permutations and Combinations", "Binomial Theorem", "Sequences and Series", "Limits and Continuity", 
                    "Differentiation", "Applications of Derivatives", "Indefinite Integrals", "Definite Integrals", 
                    "Applications of Integrals", "Differential Equations", "Straight Lines", "Circles", "Conic Sections", 
                    "Three Dimensional Geometry", "Vector Algebra", "Statistics", "Probability", "Trigonometry", 
                    "Mathematical Reasoning", "Mathematical Induction"];
                
                mathChapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter;
                    option.textContent = chapter;
                    chapterSelect.appendChild(option);
                });
            } else if (subject === 'Biology') {
                const bioChapters = ["Diversity in Living World", "Structural Organization in Plants and Animals", "Cell Structure and Function", 
                    "Plant Physiology", "Human Physiology", "Reproduction", "Genetics and Evolution", "Biology and Human Welfare", 
                    "Biotechnology and its Applications", "Ecology and Environment"];
                
                bioChapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter;
                    option.textContent = chapter;
                    chapterSelect.appendChild(option);
                });
            }
        }
        
        // Initialize on page load
        
        // Function to toggle question fields based on type
        function toggleQuestionFields() {
            const questionType = document.getElementById('question-type').value;
            
            // Hide all option containers
            document.getElementById('mcq-options').style.display = 'none';
            document.getElementById('multiple-options').style.display = 'none';
            document.getElementById('numerical-answer').style.display = 'none';
            
            // Show the appropriate container based on question type
            if (questionType === 'mcq-single') {
                document.getElementById('mcq-options').style.display = 'block';
            } else if (questionType === 'mcq-multiple') {
                document.getElementById('multiple-options').style.display = 'block';
            } else if (questionType === 'numerical') {
                document.getElementById('numerical-answer').style.display = 'block';
            }
        }
        
        // Function to save question
        function saveQuestion(examId) {
            // Get the current question number (1-based)
            const questionNumber = currentQuestionIndex + 1;
            
            // Get section info for current question based on exam type
            let sectionInfo;
            if (examId && examId.includes('jee-advanced')) {
                sectionInfo = getAdvancedSectionInfo(questionNumber);
            } else {
                sectionInfo = getSectionInfo(questionNumber);
            }
            // Get form values
            const questionType = document.getElementById('question-type').value;
            const subject = document.getElementById('question-subject').value;
            const chapter = document.getElementById('question-chapter').value;
            const questionText = document.getElementById('question-text').value;
            const difficulty = document.getElementById('question-difficulty').value;
            const marks = document.getElementById('question-marks').value;
            
            // Validate required fields
            if (!questionType || !subject || !chapter || !questionText || !difficulty) {
                alert('Please fill in all required fields');
                return;
            }
            
            // Disable save button
            const saveBtn = document.getElementById('save-question-btn');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Saving...';
            
            // Get the next question number
            let questionNo = 1;
            
            // Create question ID based on paper name, subject, chapter, type, and question number
            // Format: papername-subject-chapter-type-questionno
            // Clean up chapter name for ID (remove spaces, special chars)
            const cleanChapter = chapter.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
            const cleanSubject = subject.toLowerCase();
            const cleanType = questionType.replace('mcq-', '').toLowerCase();
            
            // Create the question ID
            const questionId = `${examId}-${cleanSubject}-${cleanChapter}-${cleanType}-${questionNo}`;
            
            // Create timestamp
            const timestamp = new Date().getTime();
            
            // Create question object
            let question = {
                id: questionId,
                text: questionText,
                type: questionType,
                subject: subject,
                chapter: chapter,
                difficulty: difficulty,
                marks: parseInt(marks) || 4,
                examId: examId,
                createdAt: timestamp
            };
            
            // Add type-specific data
            if (questionType === 'mcq-single') {
                const options = [
                    document.getElementById('option-a-text').value,
                    document.getElementById('option-b-text').value,
                    document.getElementById('option-c-text').value,
                    document.getElementById('option-d-text').value
                ];
                
                // Check if all options are filled
                if (options.some(opt => !opt.trim())) {
                    alert('Please fill in all options');
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                    return;
                }
                
                // Get correct option
                const correctOption = document.querySelector('input[name="correct-option"]:checked');
                if (!correctOption) {
                    alert('Please select the correct option');
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                    return;
                }
                
                question.options = options;
                question.correctOption = parseInt(correctOption.value);
            } else if (questionType === 'mcq-multiple') {
                const options = [
                    document.getElementById('multi-option-a-text').value,
                    document.getElementById('multi-option-b-text').value,
                    document.getElementById('multi-option-c-text').value,
                    document.getElementById('multi-option-d-text').value
                ];
                
                // Check if all options are filled
                if (options.some(opt => !opt.trim())) {
                    alert('Please fill in all options');
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                    return;
                }
                
                // Get correct options
                const correctOptions = [
                    document.getElementById('multi-option-a-correct').checked,
                    document.getElementById('multi-option-b-correct').checked,
                    document.getElementById('multi-option-c-correct').checked,
                    document.getElementById('multi-option-d-correct').checked
                ];
                
                // Check if at least one option is selected
                if (!correctOptions.some(opt => opt)) {
                    alert('Please select at least one correct option');
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                    return;
                }
                
                question.options = options;
                question.correctOptions = correctOptions;
            } else if (questionType === 'numerical') {
                const answer = document.getElementById('numerical-value').value;
                
                if (!answer.trim()) {
                    alert('Please enter the correct numerical answer');
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                    return;
                }
                
                question.answer = answer;
            } else if (questionType === 'match-list') {
                // Handle match list questions if needed
                alert('Match list questions are not fully implemented yet');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                return;
            }
            
            // Save to Firebase - no need to check paper existence again
            try {
                if (db) {
                    // Get question count directly (paper existence was already checked on page load)
                    db.collection('papers').doc(examId).collection('questions').get()
                        .then(snapshot => {
                            // Update question number based on existing questions
                            const questionNo = snapshot.size + 1;
                            
                            // Update the question ID with the correct question number
                            const cleanChapter = chapter.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
                            const cleanSubject = subject.toLowerCase();
                            const cleanType = questionType.replace('mcq-', '').toLowerCase();
                            
                            // Create the final question ID
                            const finalQuestionId = `${examId}-${cleanSubject}-${cleanChapter}-${cleanType}-${questionNo}`;
                            
                            // Update the question object with the final ID
                            question.id = finalQuestionId;
                            question.questionNo = questionNo;
                            
                            // Save the question to the paper's questions subcollection
                            return db.collection('papers').doc(examId).collection('questions').doc(finalQuestionId).set(question);
                        })
                        .then(() => {
                            // Show success message with question ID
                            alert('Question added successfully!\n\nQuestion ID: ' + question.id);
                            document.getElementById('question-form').reset();
                            document.getElementById('question-subject').value = 'Physics';
                            updateChapters('Physics');
                            toggleQuestionFields();
                            
                            // Re-enable save button
                            saveBtn.disabled = false;
                            saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                            
                            // Move to next question
                            nextQuestion();
                        })
                        .catch(error => {
                            console.error('Error saving question:', error);
                            alert('Error saving question: ' + error.message);
                            saveBtn.disabled = false;
                            saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                        });
                } else {
                    // Fallback for when Firebase is not available
                    console.log('Firebase not initialized. Would save question to exam:', examId, question);
                    setTimeout(() => {
                        alert('Question would be added to ' + examId + ' (Firebase not available)');
                        document.getElementById('question-form').reset();
                        document.getElementById('question-subject').value = 'Physics';
                        updateChapters('Physics');
                        toggleQuestionFields();
                        
                        // Re-enable save button
                        saveBtn.disabled = false;
                        saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
                        
                        // Move to next question
                        nextQuestion();
                    }, 1000);
                }
            } catch (error) {
                console.error('Error in save process:', error);
                alert('Error in save process: ' + error.message);
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save me-2"></i> Save Question';
            }
        }
    </script>

    <script src="final-fix.js"></script>
    <script>
        // Last resort inline script to add the folder button
        setTimeout(function() {
            const topButtonGroup = document.querySelector('.top-navbar .d-flex.align-items-center');
            if (topButtonGroup && !document.getElementById('folder-images-btn')) {
                const folderButton = document.createElement('button');
                folderButton.id = 'folder-images-btn';
                folderButton.className = 'btn btn-info me-3';
                folderButton.innerHTML = '<i class="fas fa-folder-open me-1"></i> Load Images from Folder';
                folderButton.onclick = function() {
                    if (typeof showFolderSelectionModal === 'function') {
                        showFolderSelectionModal();
                    } else {
                        alert('Please refresh the page and try again');
                    }
                };
                topButtonGroup.appendChild(folderButton);
                console.log('Folder button added by inline script');
            }
        }, 2000);
    </script>
</body>
</html>